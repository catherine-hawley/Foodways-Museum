<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="Catherine Hawley">  
  <meta name="robots" content="noindex, nofollow"> 
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link href="../css/style.css" rel="stylesheet" type="text/css">
  <title>Museum Cart</title>
  <style>
    /* Simple Cart Styles */
    main {
      max-width: 800px;
      margin: 20px auto;
      padding: 20px;
      background-color: #ffffff;
    }

    .controls {
      background-color: #e8f4f8;
      padding: 15px;
      margin-bottom: 20px;
    }

    .controls label {
      font-size: 1.1rem;
      font-weight: bold;
    }

    .empty {
      padding: 20px;
      border: 2px dashed #999;
      text-align: center;
      font-style: italic;
    }

    #items {
      margin-bottom: 20px;
    }

    .cart-item {
      padding: 10px;
      border-bottom: 1px solid #ccc;
      margin-bottom: 10px;
    }

    .remove-btn {
      background-color: #dc3545;
      color: white;
      border: none;
      padding: 5px 15px;
      cursor: pointer;
      margin-left: 10px;
    }

    #summary {
      background-color: #f5f5f5;
      padding: 20px;
      font-family: monospace;
      border: 1px solid #999;
      margin-bottom: 20px;
    }

    .actions {
      margin-top: 20px;
    }

    #clearBtn {
      background-color: #666;
      color: white;
      border: none;
      padding: 10px 20px;
      cursor: pointer;
      margin-right: 10px;
    }

    .actions a {
      background-color: #5B8FA3;
      color: white;
      text-decoration: none;
      padding: 10px 20px;
    }
  </style>
</head>
<body>
  <header>
    <h1>Shopping Cart</h1>
  </header>

  <main>
    <!-- Member Discount Toggle -->
    <div class="controls">
      <label>
        <input type="checkbox" id="memberToggle">
        Member Discount (15%)
      </label>
    </div>

    <!-- Empty Cart Message -->
    <div id="emptyMsg" class="empty" hidden>
      Your cart is empty.
    </div>

    <!-- Cart Items -->
    <div id="items" hidden></div>

    <!-- Order Summary -->
    <pre id="summary" hidden></pre>

    <!-- Actions -->
    <div class="actions">
      <button id="clearBtn">Clear Cart</button>
      <a href="shop.html">Keep Shopping</a>
    </div>
  </main>

  <script>
  /* =================== CART FUNCTIONS =================== */
  const CART_KEY = 'museumCartV1';

  function readCart(){
    try { return JSON.parse(localStorage.getItem(CART_KEY)) || []; }
    catch { return []; }
  }
  
  function writeCart(cart){
    localStorage.setItem(CART_KEY, JSON.stringify(cart));
  }

  function money(n){
    const sign = n < 0 ? -1 : 1;
    const s = '$' + Math.abs(n).toFixed(2);
    return sign < 0 ? '('+s+')' : s;
  }

  const TAX_RATE = 0.102;
  const MEMBER_DISCOUNT_RATE = 0.15;
  const SHIPPING_RATE = 25.00;
  const VOLUME_TIERS = [
    [0.00, 49.99, 0.00],
    [50.00, 99.99, 0.05],
    [100.00, 199.99, 0.10],
    [200.00, Infinity, 0.15]
  ];

  function volumeRate(total){
    for (const [min,max,rate] of VOLUME_TIERS){
      if (total >= min && total <= max) return rate;
    }
    return 0;
  }

  function removeItem(id){
    const next = readCart().filter(it => it.id !== id);
    writeCart(next);
    render();
  }

  function clearCart(){
    writeCart([]);
    document.getElementById('memberToggle').checked = false;
    render();
  }

  /* ====================== RENDER FUNCTION ================================= */
  function render(){
    const itemsDiv   = document.getElementById('items');
    const summaryPre = document.getElementById('summary');
    const emptyMsg   = document.getElementById('emptyMsg');
    const isMember   = document.getElementById('memberToggle').checked;

    let cart = readCart().filter(it => it.qty > 0 && it.unitPrice > 0);

    // If cart is empty
    if (cart.length === 0) {
      emptyMsg.hidden = false;
      itemsDiv.hidden = true;
      summaryPre.hidden = true;
      return;
    }

    // Show cart items
    emptyMsg.hidden = true;
    itemsDiv.hidden = false;
    summaryPre.hidden = false;

    // Build items list
    let itemsHTML = '';
    let itemTotal = 0;

    cart.forEach(item => {
      const lineTotal = item.unitPrice * item.qty;
      itemTotal += lineTotal;
      
      itemsHTML += `
        <div class="cart-item">
          ${item.qty} Ã— ${item.name} - ${money(lineTotal)}
          <button class="remove-btn" onclick="removeItem('${item.id}')">Remove</button>
        </div>
      `;
    });

    itemsDiv.innerHTML = itemsHTML;

    // Calculate discounts
    let memberDiscount = 0;
    let volumeDiscount = 0;
    const volRate = volumeRate(itemTotal);

    // Single discount rule
    if (isMember && volRate > 0) {
      const choice = prompt("Only one discount may be applied. Type 'M' for Member or 'V' for Volume:");
      if (choice && choice.toUpperCase() === 'M') {
        memberDiscount = itemTotal * MEMBER_DISCOUNT_RATE;
      } else if (choice && choice.toUpperCase() === 'V') {
        volumeDiscount = itemTotal * volRate;
      }
    } else if (isMember) {
      memberDiscount = itemTotal * MEMBER_DISCOUNT_RATE;
    } else if (volRate > 0) {
      volumeDiscount = itemTotal * volRate;
    }

    // Calculate totals
    const subtaxable = itemTotal - memberDiscount - volumeDiscount + SHIPPING_RATE;
    const taxAmount = subtaxable * TAX_RATE;
    const invoiceTotal = subtaxable + taxAmount;

    // Build summary
    summaryPre.textContent = 
`Subtotal of Items:        ${money(itemTotal)}
Volume Discount:          ${money(-volumeDiscount)}
Member Discount:          ${money(-memberDiscount)}
Shipping:                 ${money(SHIPPING_RATE)}
Subtotal (Taxable):       ${money(subtaxable)}
Tax Rate:                 ${(TAX_RATE * 100).toFixed(1)}%
Tax Amount:               ${money(taxAmount)}
Invoice Total:            ${money(invoiceTotal)}`;
  }

  // Events
  document.getElementById('memberToggle').addEventListener('change', render);
  document.getElementById('clearBtn').addEventListener('click', clearCart);


  render();
  </script>
</body>
</html>
